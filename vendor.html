<!DOCTYPE html>
<html>
<head><meta charset="utf-8">

<title> Retail Supply chain </title>

</head><body>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
    type="application/javascript"></script>
    <script src="abi.js" type="application/javascript"></script>
    
<h1> SUPPLYCHAIN MANAGEMENT VENDOR</h1>
<button onclick="asd()">connect</button>
<p id="connected"></p>
<p id="data"></p>
<p id="data1"></p>
<button onclick="writeDATA()"> Add Supply unit </button>

<script>
     const provider = new ethers.providers.Web3Provider(window.ethereum)

    // MetaMask requires requesting permission to connect users accounts
    provider.send("eth_requestAccounts", []);

    // The MetaMask plugin also allows signing transactions to
    // send ether and pay to change state within the blockchain.
    // For this, you need the account signer...
    const signer = provider.getSigner();

    contractAdr = '0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512';
    contractAbi = supplychainabi;
    
    const supplychain = new ethers.Contract(contractAdr, contractAbi, provider);

    async function asd()
    {
    //console.log("WALLET CONNECT");
    //ethereum.request({ method: 'eth_requestAccounts' });
    // A Web3Provider wraps a standard Web3 provider, which is
    // what MetaMask injects as window.ethereum into each page
   
    //https://docs.ethers.org/v5/getting-started/
    //https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises
    ADDRESS = signer.getAddress()
    bl = await provider.getBalance(ADDRESS)
    document.getElementById("connected").innerHTML = "Wallet connected"
    
    document.getElementById("data").innerHTML = bl + ' IS THE BALANCE OF WALLET'
    
    

    try {
        owner = await supplychain.owner();
        document.getElementById("data1").innerHTML = "owner is "+owner;
    }
    catch(err) {
        document.getElementById("data").innerHTML = err.message;
    }

    
    //The below methods are state changing and require a signer

    
}
    //first to add an unit, we want all detail to the UNIT struct
    //initial location can be just 0

    function makeUNIT(aindex, aresponsibleAddress, aexpected_time, aquantity, aexp_latitude, aexp_longitude, alatitude, alongitude, atime_began)
    {     
        const obj = {
        index : aindex,

        responsibleAddress : aresponsibleAddress,
        expected_time : aexpected_time,
        quantity : aquantity,
        exp_latitude : aexp_latitude,
        exp_longitude : aexp_longitude,

        
        latitude : alatitude,
        longitude : alongitude,
        time_began : atime_began
        }

        return obj;
    }

    function promptUNIT()
    {
        index = prompt("Enter index")
        responsibleAddress = prompt("Enter responsible address")
        expected_time = prompt("Enter expected time")
        quantity = prompt("Enter quantity")
        exp_latitude = prompt("Enter expected latitude")
        exp_longitude = prompt("Enter expected longitude")
        latitude = prompt("latitude")
        longitude = prompt("Enter longitude")
        time_began = prompt("Enter time at which supply started to move")

        result = makeUNIT(index, responsibleAddress, expected_time, quantity, exp_latitude, exp_longitude, latitude, longitude, time_began);    
        console.log(result)
        return result
    }

    function prn(str)
    {
        document.getElementById("data").innerHTML = str;
    }

    async function writeDATA()
    {
        // a = promptUNIT()
        // document.getElementById('data').innerHTML = a;
        // console.log(a)
        // console.log({2:3, 4:4})

        /*
        const obj = {
        index : 0,

        responsibleAddress : '0x5FbDB2315678afecb367f032d93F642f64180aa3',
        expected_time : 0,
        quantity : 0,
        exp_latitude : 0,
        exp_longitude : 0,

        
        latitude : 0,
        longitude : 0,
        time_began : 0
        }
            */
        

        prn(withSigner)

        prn("vendor emitted locations ")

    }
    
    
</script>


</body>

</html>
