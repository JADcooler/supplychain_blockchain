<!DOCTYPE html>
<html>
<head><meta charset="utf-8">

<title> Retail Supply chain </title>

</head><body>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
    type="application/javascript"></script>
    <script src="abi.js" type="application/javascript"></script>
    
<h1> WASSAAAP </h1>
<button onclick="asd()">connaact</button>
<p id="connected"></p>
<p id="data"></p>
<p id="data1"></p>

<script>
    async function asd()
    {
    //console.log("WALLET CONNECT");
    //ethereum.request({ method: 'eth_requestAccounts' });
    // A Web3Provider wraps a standard Web3 provider, which is
    // what MetaMask injects as window.ethereum into each page
    const provider = new ethers.providers.Web3Provider(window.ethereum)

    // MetaMask requires requesting permission to connect users accounts
    provider.send("eth_requestAccounts", []);

    // The MetaMask plugin also allows signing transactions to
    // send ether and pay to change state within the blockchain.
    // For this, you need the account signer...
    const signer = provider.getSigner();
    //https://docs.ethers.org/v5/getting-started/
    //https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises
    ADDRESS = signer.getAddress()
    bl = await provider.getBalance(ADDRESS)
    document.getElementById("connected").innerHTML = "Wallet connected"
    contractAdr = '0x5FbDB2315678afecb367f032d93F642f64180aa3';
    contractAbi = supplychainabi;
    
    const supplychain = new ethers.Contract(contractAdr, contractAbi, provider);
    document.getElementById("data").innerHTML = bl + ' IS THE BALANCE OF WALLET'
    
    

    try {
        owner = await supplychain.owner();
    }
    catch(err) {
        document.getElementById("data").innerHTML = err.message;
    }

    document.getElementById("data1").innerHTML = "owner is "+owner;
    //The below methods are state changing and require a signer

    withSigner = supplychain.connect(signer)

    //first to add an unit, we want all detail to the UNIT struct
    //initial location can be just 0

    function makeUNIT(index, responsibleAddress, expected_time, quantity, exp_latitude, exp_longitude, latitude, longitude, time_began)
    {     
        this.index = index;

        this.responsibleAddress = responsibleAddress;   
        this.expected_time = expected_time;
        this.quantity = quantity;
        this.exp_latitude = exp_latitude;
        this.exp_longitude = exp_longitude;

        
        this.latitude = latitude;
        this.longitude = longitude;
        this.time_began = time_began;

        return this;
    }

    function promptUNIT()
    {
        index = prompt("Enter index")
        responsibleAddress = prompt("Enter responsible address")
        expected_time = prompt("Enter expected time")
        quantity = prompt("Enter quantity")
        exp_latitude = prompt("Enter expected latitude")
        exp_longitude = prompt("Enter expected longitude")
        
    }
    
    }
</script>
</body>

</html>
